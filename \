package pkg

// AppliableEvent is an interface that describes how event must be applied to the object.
type AppliableEvent[Agg Aggregate[ID], ID any] interface {
	// ApplyTo applies an event to the object.
	ApplyTo(agg Agg)

	// GetRelatedId returns the Aggregate ID which this event is related to.
	GetRelatedId() ID
}

// VersionedEvent is an object that represents an event with its version.
type VersionedEvent[E any] struct {
	// State is the event itself.
	State E
	// Ver is the Version of the event.
	Ver Version
}

type EventSet[Agg Aggregate[ID], ID any, Ev AppliableEvent[Agg, ID]] struct {
	Events []Ev
}

func (es *EventSet[Agg, Id, Ev]) ApplyTo(agg Agg) {
	for _, ev := range es.Events {
		ev.ApplyTo(agg)
	}
}

func (es *EventSet[Agg, ID, Ev]) GetRelatedId() ID {
	id := es.Events[0].GetRelatedId()
	for _, ev := range es.Events {
		ev_id := ev.GetRelatedId()
		if ev_id != id {
			panic("events have incompatible Id's")
		}
	}

	return id
}
